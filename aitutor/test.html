<!doctype html>
<html>
<head>
	<meta charset="utf8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>mic</title>
	<link rel="stylesheet" href="style.css"/>
	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/web-animations/2.3.1/web-animations.min.js"></script>-->
	<script src="../src/js/1px.js"></script>
	<!--<script type="module" src="./components/dialog.js"></script>-->
	<!--<script type="module" src="components/waitdots.js"></script>-->
	<script type="module" src="components/testdb.js"></script>
	<!--<script type="module" src="components/ui-speech-to-text.js"></script>-->
	<!--<script type="module" src="components/ui-text-to-speech.js"></script>-->


	<script type="module" src="components/ui-speech-to-text2.js"></script>
	<script type="module" src="components/ui-text-to-speech2.js"></script>

	<script type="module" src="components/ai-test.js"></script>
	<script type="module" src="components/animated-dialog.js"></script>


	<script type="module" src="components/micwave.js"></script>


</head>
<body>

<main>
	<content>
		<!--<ai-app-prototype></ai-app-prototype>-->
		<!--<ai-app></ai-app>-->
		<animated-dialog id="app"></animated-dialog>

		<ui-speech-to-text id="stt" style="margin: auto; height: auto;"></ui-speech-to-text>
		<!--<ai-app-screen></ai-app-screen>-->

		<!--<ui-text-to-speech id="tts"></ui-text-to-speech>-->

		<!--<ai-test></ai-test>-->
	</content>
</main>

<script type="module">

$module.require(["DB", "$timeout"], function(DB, $timeout, STT) {

	function capitalize(str) {
		return str[0].toUpperCase() + str.slice(1);
	}


	window.app = document.getElementById("app");

	// let guide = document.getElementById("guide");
	let stt = document.getElementById("stt");
	stt.guide_text = "커피 주문하기";

	document.onclick = function() {
		document.onclick = null;
		next();

		// app.ask(DB[0][0]).then(next);
	};

	let stage = 0;
	let level = 0;
	let voice = parseInt(Math.random() * 17);

	let query = "";

	function next() {
		stt.style.opacity = 0;


		let ment = DB[stage][0][level];
		if (query && level === 0 && query !== "no" && query !== "yes" && query !== "ok" && query !== "okay") {
			ment = capitalize(query) + ". " + ment;
		}

		app.ask(ment, voice).then(_ => {

			// guide.style.opacity = 1;
			stt.style.opacity = 1;


			return stt.listen(DB[stage][1]);

		}).then(isok => {

			if (isok) {
				query = isok;

				stage++;
				level = 0;
			} else {
				if (DB[stage][0][level + 1]) {
					level++;
				} else {
					stage++;
					level = 0;
				}


			}

			return next();

		});

	}


});


</script>

</body>
</html>