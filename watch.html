<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<script>window.exports = window;</script>
	<script src="1px.js.new/1px.js"></script>
</head>
<body>

<script>
const {Observable} = require();


function watch$$(object, prop) {

	if (Object(object) !== object) {
		return Observable.NEVER;
	}

	if (Array.isArray(object) && +prop === prop) {
		return Observable.NEVER;
	}

	const desc = Object.getOwnPropertyDescriptor(object, prop);
	if (desc && desc.set && desc.set.observable$) {
		return desc.set.observable$;
	}

	let observable$;

	return (observable$ = new Observable(observer => {
		const desc = Object.getOwnPropertyDescriptor(object, prop);
		if (desc && desc.set && desc.set.observable$) {
			return desc.set.observable$.subscribe(observer);
		}

		let value = object[prop];

		function set(newValue) {
			if (Object.is(value, newValue)) return;
			value = newValue;
			observer.next(value);
			// observer.complete();
		}

		set.observable$ = observable$;

		Object.defineProperty(o, prop, {
			get: () => value,
			set: set,
			configurable: desc.configurable,
			enumerable: desc.enumerable,
		});

		return () => {
			desc.value = value;
			Object.defineProperty(o, prop, desc);
		}

	}).share());
}



let o = {};
let s = watch$$(o, "a");
let s2 = watch$$(o, "a").subscribe(console.warn);

o.a = 300;


s.subscribe(console.warn);


o.a = 500;

</script>


</body>
</html>