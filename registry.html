<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>

<script>

function Registry() {
	this.value = Object.create(null);
	this.queue = Object.create(null);
}

Registry.prototype = {
	whenDefined(name, callbackFn) {
		if (name in this.value) {
			callbackFn(this.value[name]);
			return;
		}

		this.queue[name] = this.queue[name] || [];
		this.queue[name].push(callbackFn);
	},

	define(name, value) {
		this.value[name] = value;
		for (let callbackFn of this.queue[name] || []) {
			callbackFn(value);
		}
		delete this.queue[name];
	}
};

let registry = new Registry();


function value(name, value) {
	registry.define(name, value);
}

function factory(name, value) {
	registry.define(name, value);
}

function require(name, value) {
	registry.define(name, value);
}


</script>

</body>
</html>