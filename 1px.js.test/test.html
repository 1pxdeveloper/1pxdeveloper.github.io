<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<script src="1px.js"></script>
</head>
<body>


<script>
const {Subject, BehaviorSubject} = require();


const $timeout = function(delay, value) {
	return new Promise(resolve => {
		setTimeout(() => {
			console.log(value);
			resolve(value);
		}, delay);
	});
};


class Test {
	constructor() {
		this.pause$ = new BehaviorSubject(false);
		this.pauseSwitch$$ = (callback) => this.pause$.switchMap(paused => paused ? Observable.NEVER : callback());

		this.actions$ = new Subject();

		this.actionsSubscription = this.actions$.concatMap(action => {

			console.log(action);

			return action;

		}).subscribe();
	}

	begin() {
		this.seq = Observable.empty();
	}

	block(callback) {

		this.seq = this.seq.concat(this.pauseSwitch$$(callback));


		return this.seq;


		// let o = this.pauseSwitch$$(callback);
		//
		// this.actions$.next(o);
		//
		// return o;
	}

	run() {

		console.log("run");


		Observable.of(0)
			.concatMap(() => {
				return Observable.timeout(1000, "h")
					.concatMap(h => {
						console.log("_h", h);

						return $timeout(1000, "h2");
					})
			})
			.concatMap(h => {
				console.log("h", h);

				return $timeout(1000, "b");
			})
			.concatMap(() => {
				return $timeout(1000, "c");
			})
			.concatMap(() => {
				return $timeout(1000, "d");
			})
			.concatMap(() => {
				return $timeout(1000, "e");
			})
			.subscribe();
	}
}


let t = new Test();
t.run();


</script>

</body>
</html>