<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>

<script id="test" type="text/plain">


// 이것은 주석
-- Default Welcome Intent

#1 이것도 주석
Hello, my name is yoo. What's your name?
Good Job.
Welcome to 'Mission English'.

[뭐라고 말하세요.] [다른걸 해도 되요]

(1. 미션일때) -> abc
(fallback) -> def
(sports) -> sss


#2
Ta-da
Good boy.
Call me My name.

[ttt] [abc]

(1. 미션일때) -> abc
(fallback) -> def
(sports) -> sss



-- abc

Ta-da
Good Job.

(fallback) -> #abc









</script>


<script>
let t = document.getElementById("test");
t = t.innerText;

parsePage(t);


function parsePage(t) {

	let content = {};
	let contents = [];
	let pages = {};

	let re_charstart = /[0-9a-zA-Z가-힣]/;
	let re_chips = /\[\s*([^\]]+)\s*\]/g;
	let re_switch = /\(\s*([^\)]+)\s*\)\s*->\s*(.+)/g;

	t.split(/\n+/).forEach(line => {
		line = line.trim();
		if (!line) return;

		line = line.replace(/[ ]+/g, " ");

		switch (line[0]) {
			case "-":
				line = line.slice(line.search(re_charstart));

				content = {sentence: []};
				pages[line] = contents = [content];
				break;

			case "[":

				let chips = [];
				line.replace(re_chips, function(a, b) {
					chips.push(b);
					return a;
				});

				console.log("chips", chips);

				content.chips = chips;
				break;

			case "(":

				let cond = [];
				line.replace(re_switch, function(a, b, c, d) {
					cond.push([b, c]);
					return a;
				});

				content.cond = cond;

				console.log("switch", cond);
				break;

			case "/":
			case "#":
				// console.log("comment", line);
				break;

			default:

				if (content.chips || content.cond) {
					content = {sentence: []};
					contents.push(content);
				}
				content.sentence = content.sentence || [];
				content.sentence.push(line);

				console.log("-", line);
				break;
		}
	});


	console.log(pages);

	return pages;
}


</script>


</body>
</html>